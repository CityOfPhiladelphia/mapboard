!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("vuex"),require("@cityofphiladelphia/phila-vue-comps"),require("leaflet"),require("@cityofphiladelphia/phila-vue-mapping"),require("axios"),require("@cityofphiladelphia/phila-vue-datafetch")):"function"==typeof define&&define.amd?define(["exports","vue","vuex","@cityofphiladelphia/phila-vue-comps","leaflet","@cityofphiladelphia/phila-vue-mapping","axios","@cityofphiladelphia/phila-vue-datafetch"],t):t(e.mapboard={},e.Vue,e.Vuex,e.philaVueComps,e.L,e.philaVueMapping,e.axios,e.philaVueDatafetch)}(this,function(exports,Vue,Vuex,philaVueComps,L,philaVueMapping,axios,philaVueDatafetch){"use strict";function isMobileDevice(){var e=navigator.userAgent||navigator.vendor||window.opera||"";return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function getHorizontalTableIdsFromComps(e){void 0===e&&(e=[]);for(var t=[],a=0,i=e;a<i.length;a+=1){var o=i[a],r=o.options||{},n=r.components||r.tables;if(n){var s=getHorizontalTableIdsFromComps(n);t=t.concat(s)}else if("horizontal-table"===o.type){var l=o._id;t.push(l)}}return t}function createFilteredData(e){for(var t=[],a=0,i=e.topics;a<i.length;a+=1){var o=getHorizontalTableIdsFromComps(i[a].components);t=t.concat(o)}for(var r={},n=0;n<t.length;n++)r[t[n]]=[];return r}function getHorizontalTableGroupIdsFromComps(e){var t;void 0===e&&(e=[]);for(var a=0,i=e;a<i.length;a+=1){var o=i[a],r=o.options||{};(r.components||r.tables)&&("horizontal-table-group"===o.type&&(t=o._id))}return t}function createHorizontalTableGroups(e){for(var t=[],a=0,i=e.topics;a<i.length;a+=1){var o=getHorizontalTableGroupIdsFromComps(i[a].components);o&&t.push(o)}for(var r={},n=0,s=t;n<s.length;n+=1){r[s[n]]={activeTable:null,activeTableId:null}}return r}function createStore(e){var t=Object.keys(e.dataSources||{}).reduce(function(t,a){var i;return i=e.dataSources[a].targets?{targets:{}}:{status:null,secondaryStatus:null,data:null},t[a]=i,t},{}),a=Object.keys(e.parcels||{}).reduce(function(t,a){var i;return i=e.parcels[a].multipleAllowed?{data:[],status:null,activeParcel:null,activeAddress:null,activeMapreg:null}:null,t[a]=i,t},{}),i={isMobileOrTablet:isMobileDevice(),fullScreen:{mapOnly:!1,topicsOnly:!1},fullScreenMapEnabled:!1,fullScreenTopicsEnabled:!1,activeTopic:"",activeParcelLayer:"",clickCoords:null,geocode:{status:null,data:null,input:null,related:null},lastSearchMethod:"geocode",map:{location:{lat:null,lng:null},center:e.map.center,bounds:{northEast:null,southWest:null},zoom:e.map.zoom,boundsBasedOnShape:null,map:null,basemap:"",imagery:"imagery2017",shouldShowImagery:!1,imageOverlay:null,imageOverlayOpacity:null,filters:[],watchPositionOn:!1},shouldShowAddressCandidateList:!1,candidates:[],addressEntered:null,parcels:a,sources:t,cyclomedia:{initialized:!1,navBarOpen:!1,latLngFromMap:null,orientation:{yaw:null,hFov:null,xyz:null},active:!1,recordings:[]},pictometry:{ipa:null,active:!1,shapeIds:[],pngMarkerIds:[],zoom:null,map:{center:e.map.center,zoom:e.map.zoom}},horizontalTables:{filteredData:createFilteredData(e)},horizontalTableGroups:createHorizontalTableGroups(e),activeFeature:{featureId:null,tableId:null},appData:{propertyBalance:0}};return new Vuex.Store({state:i,getters:{visibleTableIds:function(t){var a=t.activeTopic;if(!a)return[];var i=(e.topics.filter(function(e){return e.key===a})||[])[0].components,o=getHorizontalTableGroupIdsFromComps(i);if(o){var r=[];return r.push(t.horizontalTableGroups[o].activeTableId),r}return getHorizontalTableIdsFromComps(i)}},mutations:{setCyclomediaInitialized:function(e,t){e.cyclomedia.initialized=t},setIsMobileOrTablet:function(e,t){e.isMobileOrTablet=t},setMapOnly:function(e,t){e.fullScreen.mapOnly=t},setTopicsOnly:function(e,t){e.fullScreen.topicsOnly=t},setFullScreenMapEnabled:function(e,t){e.fullScreenMapEnabled=t},setFullScreenTopicsEnabled:function(e,t){e.fullScreenTopicsEnabled=t},setLocation:function(e,t){e.map.location.lat=t.lat,e.map.location.lng=t.lng},setWatchPositionOn:function(e,t){e.map.watchPositionOn=t},setClickCoords:function(e,t){e.clickCoords=t},setHorizontalTableGroupActiveTable:function(e,t){e.horizontalTableGroups[t.tableGroupId].activeTableId=t.activeTableId,e.horizontalTableGroups[t.tableGroupId].activeTable=t.activeTable},setHorizontalTableFilteredData:function(e,t){var a=t.tableId,i=t.data;a&&(e.horizontalTables.filteredData[a]=i)},setActiveTopic:function(e,t){e.activeTopic=t},setActiveParcelLayer:function(e,t){e.activeParcelLayer=t},setSourceStatus:function(e,t){var a=t.key,i=t.status,o=t.targetId;o?e.sources[a].targets[o].status=i:e.sources[a].status=i},setSecondarySourceStatus:function(e,t){var a=t.key,i=t.secondaryStatus;t.targetId;e.sources[a].secondaryStatus=i},setSourceData:function(e,t){var a=t.key,i=t.data,o=t.targetId;o?e.sources[a].targets[o]&&(e.sources[a].targets[o].data=i):e.sources[a].data=i},setSourceDataMore:function(e,t){var a=t.key,i=t.data,o=t.page,r=e.sources[a].data.features.concat(i.features);e.sources[a].data.features=r,e.sources[a].data.page=o},setMapFilters:function(e,t){e.map.filters=t},createEmptySourceTargets:function(e,t){var a=t.key,i=t.targetIds;e.sources[a].targets=i.reduce(function(e,t){return e[t]={status:null,data:null},e},{})},clearSourceTargets:function(e,t){var a=t.key;e.sources[a].targets={}},setMap:function(e,t){e.map.map=t.map},setMapCenter:function(e,t){e.map.center=t},setMapZoom:function(e,t){e.map.zoom=t},setMapBounds:function(e,t){e.map.bounds=t},setMapBoundsBasedOnShape:function(e,t){e.map.boundsBasedOnShape=t},setParcelData:function(e,t){var a=t||{},i=a.parcelLayer,o=a.data,r=a.multipleAllowed,n=a.status,s=a.activeParcel,l=a.activeAddress,c=a.activeMapreg;r?(e.parcels[i].data=o,e.parcels[i].status=n,e.parcels[i].activeParcel=s,e.parcels[i].activeAddress=l,e.parcels[i].activeMapreg=c):e.parcels[i]=o},setActiveParcel:function(e,t){var a=t||{},i=a.parcelLayer,o=a.activeParcel,r=a.activeAddress,n=a.activeMapreg;e.parcels[i].activeParcel=o,e.parcels[i].activeAddress=r,e.parcels[i].activeMapreg=n},setGeocodeStatus:function(e,t){e.geocode.status=t},setGeocodeData:function(e,t){e.geocode.data=t},setGeocodeRelated:function(e,t){e.geocode.related=t},setGeocodeInput:function(e,t){e.geocode.input=t},setBasemap:function(e,t){e.map.basemap=t},setImagery:function(e,t){e.map.imagery=t},setShouldShowImagery:function(e,t){e.map.shouldShowImagery=t},setPictometryActive:function(t,a){e.pictometry.enabled&&(t.pictometry.active=a)},setCyclomediaActive:function(t,a){e.cyclomedia.enabled&&(t.cyclomedia.active=a)},setCyclomediaYaw:function(e,t){e.cyclomedia.orientation.yaw=t},setCyclomediaHFov:function(e,t){e.cyclomedia.orientation.hFov=t},setCyclomediaXyz:function(e,t){e.cyclomedia.orientation.xyz=t},setCyclomediaRecordings:function(e,t){e.cyclomedia.recordings=t},setCyclomediaLatLngFromMap:function(e,t){e.cyclomedia.latLngFromMap=t},setCyclomediaNavBarOpen:function(e,t){e.cyclomedia.navBarOpen=t},setActiveFeature:function(e,t){var a=t||{},i={featureId:a.featureId,tableId:a.tableId};e.activeFeature=i},setLastSearchMethod:function(e,t){e.lastSearchMethod=t},setPictometryIpa:function(e,t){e.pictometry.ipa=t},setPictometryShapeIds:function(e,t){e.pictometry.shapeIds=t},setPictometryPngMarkerIds:function(e,t){e.pictometry.pngMarkerIds=t},setPictometryMapCenter:function(e,t){e.pictometry.map.center=t},setPictometryMapZoom:function(e,t){e.pictometry.map.zoom=t},setPictometryZoom:function(e,t){e.pictometry.zoom=t},setImageOverlay:function(e,t){e.map.imageOverlay=t},setImageOverlayOpacity:function(e,t){e.map.imageOverlayOpacity=t},setShouldShowAddressCandidateList:function(e,t){e.shouldShowAddressCandidateList=t},setCandidates:function(e,t){e.candidates=t},setAddressEntered:function(e,t){e.addressEntered=t},setPropertyBalance:function(e,t){e.appData.propertyBalance=t}}})}function configMixin(e,t){e.mixin({created:function(){this.$config=t}})}Vue=Vue&&Vue.hasOwnProperty("default")?Vue.default:Vue,Vuex=Vuex&&Vuex.hasOwnProperty("default")?Vuex.default:Vuex,philaVueComps=philaVueComps&&philaVueComps.hasOwnProperty("default")?philaVueComps.default:philaVueComps,philaVueMapping=philaVueMapping&&philaVueMapping.hasOwnProperty("default")?philaVueMapping.default:philaVueMapping,axios=axios&&axios.hasOwnProperty("default")?axios.default:axios,philaVueDatafetch=philaVueDatafetch&&philaVueDatafetch.hasOwnProperty("default")?philaVueDatafetch.default:philaVueDatafetch,Vue.use(Vuex),function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),a=" /*don't highlight any form elements*/ input[data-v-c37cf8b6]:focus, select[data-v-c37cf8b6]:focus, textarea[data-v-c37cf8b6]:focus, button[data-v-c37cf8b6]:focus { outline: none; } /* standards applies padding to buttons, which causes some weirdness with buttons on the map panel. override here. */ button[data-v-c37cf8b6] { padding: inherit; } .mb-panel-topics[data-v-c37cf8b6] { position: relative; } .address-header[data-v-c37cf8b6] { background: #daedfe; color: #0f4d90; /*this keeps the box shadow over the scrollable part of the panel*/ position: relative; z-index: 1; -webkit-box-shadow: 0px 5px 7px -2px rgba(0,0,0,0.18); -moz-box-shadow: 0px 5px 7px -2px rgba(0,0,0,0.18); box-shadow: 0px 5px 7px -2px rgba(0,0,0,0.18); margin-bottom: 0px !important; display: inline-block; } .address-header-line-1[data-v-c37cf8b6] { margin-bottom: 0; margin-top: 0; padding: 0px !important; } .address-header-line-2[data-v-c37cf8b6] { padding: 0px; } .address-container[data-v-c37cf8b6] { height: 100%; display: flex; flex-direction: column; justify-content: center; padding-left: 20px; padding-top: 20px; padding-bottom: 20px; } .address-input-container[data-v-c37cf8b6] { height: 100%; display: flex; flex-direction: column; justify-content: center; padding-top: 20px; padding-bottom: 20px; } .topics-container[data-v-c37cf8b6] { padding: 26px; overflow-x: hidden; position: relative; } @media screen and (min-width: 40em) { .topics-container[data-v-c37cf8b6] { /* height: 100%; */ /* height: calc(100vh - 210px); */ } } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),e.appendChild(t)}}();var Topic=philaVueComps.Topic,TopicComponentGroup=philaVueComps.TopicComponentGroup,Greeting=philaVueComps.Greeting,AddressInput=philaVueComps.AddressInput,AddressCandidateList=philaVueComps.AddressCandidateList,FullScreenTopicsToggleTab=philaVueComps.FullScreenTopicsToggleTab,TopicPanel={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:"mb-panel-topics cell "+this.topicPanelContainerClass,attrs:{id:"topic-panel-container"}},[this.fullScreenTopicsOnly?e._e():e._m(0),e._v(" "),this.fullScreenTopicsOnly?a("div",{staticClass:"address-header cell small-24 medium-24"},[a("div",{class:"address-container columns "+this.addressContainerClass,style:this.addressContainerStyle},[a("h1",{staticClass:"address-header-line-1"},[e._v(" "+e._s(e.address)+" ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:this.geocode,expression:"this.geocode"}],staticClass:"address-header-line-2"},[e._v(" PHILADELPHIA, PA "+e._s(e.zipCode)+" ")])]),e._v(" "),this.fullScreenTopicsEnabled||this.fullScreenTopicsOnly?a("div",{staticClass:"address-input-container columns small-24 medium-12 large-12",style:this.addressInputContainerStyle},[a("address-input",{attrs:{widthFromConfig:this.addressInputWidth,placeholder:this.addressInputPlaceholder}},[this.addressAutocompleteEnabled?a("address-candidate-list",{attrs:{slot:"address-candidates-slot",widthFromConfig:this.addressInputWidth},slot:"address-candidates-slot"}):e._e(),e._v(" /> ")],1)],1):e._e()]):e._e(),e._v(" "),a("greeting",{directives:[{name:"show",rawName:"v-show",value:e.shouldShowGreeting,expression:"shouldShowGreeting"}]}),e._v(" "),e.shouldShowGreeting?e._e():a("div",{staticClass:"topic-panel-content"},[this.fullScreenTopicsOnly?e._e():a("div",{staticClass:"address-header cell small-24 medium-24"},[a("div",{class:"address-container columns "+this.addressContainerClass,style:this.addressContainerStyle},[a("h1",{staticClass:"address-header-line-1"},[a("i",{staticClass:"fa fa-map-marker"}),e._v(" "+e._s(e.address)+" ")]),e._v(" "),a("div",{staticClass:"address-header-line-2"},[e._v("PHILADELPHIA, PA "+e._s(e.zipCode))])]),e._v(" "),this.fullScreenTopicsEnabled||this.fullScreenTopicsOnly?a("div",{staticClass:"address-input-container columns small-24 medium-12 large-12",style:this.addressInputContainerStyle},[a("address-input",{attrs:{widthFromConfig:this.addressInputWidth,placeholder:this.addressInputPlaceholder}},[this.addressAutocompleteEnabled?a("address-candidate-list",{attrs:{slot:"address-candidates-slot",widthFromConfig:this.addressInputWidth},slot:"address-candidates-slot"}):e._e(),e._v(" /> ")],1)],1):e._e()]),e._v(" "),e.shouldShowGreeting?e._e():a("div",{staticClass:"topics-container cell medium-cell-block-y",style:e.topicsContainerStyle},[a("topic-component-group",{attrs:{"topic-components":this.$config.components}})],1)])],1)},staticRenderFns:[function(){var e=this.$createElement;return(this._self._c||e)("full-screen-topics-toggle-tab")}],_scopeId:"data-v-c37cf8b6",components:{Greeting:Greeting,TopicComponentGroup:TopicComponentGroup,Topic:Topic,AddressInput:AddressInput,AddressCandidateList:AddressCandidateList,FullScreenTopicsToggleTab:FullScreenTopicsToggleTab},data:function(){return{topicsContainerStyle:{"overflow-y":"auto",height:"100px"},addressContainerStyle:{height:"100%","padding-bottom:":"20px"},addressInputContainerStyle:{"align-items":"flex-start",height:"100%","padding-top":"20px"}}},mounted:function(){window.addEventListener("click",this.closeAddressCandidateList),window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()},computed:{inputAlign:function(){if(!this.$config.addressInput.position)return"flex-start";switch(this.$config.addressInput.position){case"left":return"flex-start";case"right":return"flex-end";case"center":return"center"}},addressInputWidth:function(){return this.$config.addressInput.width},addressInputPlaceholder:function(){return this.$config.addressInput.placeholder},addressAutocompleteEnabled:function(){return!0===this.$config.addressInput.autocompleteEnabled},fullScreenMapEnabled:function(){return this.$store.state.fullScreenMapEnabled},fullScreenTopicsEnabled:function(){return this.$store.state.fullScreenTopicsEnabled},fullScreenTopicsOnly:function(){return this.$store.state.fullScreen.topicsOnly},topicPanelContainerClass:function(){return this.fullScreenTopicsEnabled||this.fullScreenTopicsOnly?"medium-24 small-order-2 medium-order-1":this.fullScreenMapEnabled?"medium-1 small-order-2 medium-order-1":"medium-12 small-order-2 medium-order-1"},addressContainerClass:function(){return this.fullScreenTopicsEnabled||this.fullScreenTopicsOnly?"small-24 medium-12 large-12":"small-24"},geocode:function(){return this.$store.state.geocode.data},dorParcels:function(){return this.$store.state.parcels.dor.data.length>0},shouldShowGreeting:function(){return!(this.geocode||this.dorParcels)},address:function(){var e,t=this.geocode,a=(this.$store.state.parcels.dor.data,this.$store.state.parcels.dor.activeAddress);if(this.$config.defaultAddressTextPlaceholder&&(e=this.$config.defaultAddressTextPlaceholder),t){var i=t.properties.street_address,o=t.street_address;e=i||o}else a&&(e=a);return e},zipCode:function(){var e=this.geocode;if(!e)return null;var t=e.properties.zip_code,a=e.properties.zip_4,i=[t];return a&&i.push(a),i.join("-")}},methods:{closeAddressCandidateList:function(){this.$store.state.shouldShowAddressCandidateList=!1},shouldShowTopic:function(e){var t=e.dataSources||[];if(0===t.length)return!0;var a=this.$store.state.sources;return t.every(function(e){return a[e].data})},handleWindowResize:function(){if($(window).width()>=750){this.addressContainerStyle={height:"100%","align-items":"flex-start","padding-bottom":"20px"},this.addressInputContainerStyle={height:"100%","align-items":this.inputAlign,"padding-top":"25px"};var e=document.getElementById("mb-root"),t=window.getComputedStyle(e).getPropertyValue("height"),a=parseInt(t.replace("px",""))-103;this.topicsContainerStyle.height=a.toString()+"px",this.topicsContainerStyle["overflow-y"]="auto"}else this.addressContainerStyle={height:"auto","align-items":"center","padding-bottom":"20px"},this.addressInputContainerStyle={height:"auto","align-items":"center","padding-top":"5px"},this.topicsContainerStyle.height="auto",this.topicsContainerStyle["overflow-y"]="hidden"}}},markersMixin={watch:{activeFeature:function(e,t){var a,i,o,r,n,s,l,c=this.$store.state.map.map._layers,d=Object.values(c);t&&t.tableId&&t.featureId&&(o=(a=t).tableId,r=a.featureId,l=d.filter(function(e){var t=(e.options||{}).data;if(t){var a=t.featureId,i=t.tableId;return a===r&&i===o}})[0],this.updateMarkerFillColor(l)),e&&e.tableId&&e.featureId&&(o=(i=e).tableId,n=i.featureId,s=d.filter(function(e){var t=(e.options||{}).data;if(t){var a=t.featureId,i=t.tableId;return a===n&&i===o}})[0],this.updateMarkerFillColor(s),this.bringMarkerToFront(s))}},computed:{locationMarker:function(){return{latlng:[this.$store.state.map.location.lat,this.$store.state.map.location.lng],radius:6,fillColor:"#ff3f3f",color:"#ff0000",weight:1,opacity:1,fillOpacity:1}},markers:function(){var e=[],t=this.geocodeGeom;if("address-marker"===this.identifyFeature&&t){var a={latlng:[].concat(t.coordinates).reverse(),key:this.geocodeResult.properties.street_address,color:"#2176d2",markerType:"geocode"};e.push(a)}var i=this.activeTopicConfig.marker;if(i){for(var o=i.path,r=this.$store.state.sources,n=0,s=o;n<s.length;n+=1){var l=s[n];console.log("level:",l,"path:",r),null!==r&&void 0!==r&&(r=r[l])}if(null!==r&&void 0!==r){var c={latlng:[r[i.lat],r[i.lng]],key:r[i.key],color:i.color||"green",markerType:"overlay"};e.push(c)}}return e},circleMarkers:function(){for(var e=this.$store.state.horizontalTables.filteredData,t=[],a=0,i=this.$store.getters.visibleTableIds;a<i.length;a+=1){var o=i[a],r=((this.getConfigForTable(o)||{}).options||{}).mapOverlay;if(r&&"circle"===r.marker){var n=e[o];if(!(n.length<1))for(var s=r.style,l=0,c=n;l<c.length;l+=1){var d=c[l],p=void 0;if(d.geometry){var u=d.geometry.coordinates,h=u[0];p=[u[1],h]}else d.lat&&(p=[d.lat,d.lng]);var m=Object.assign({},s);m.latlng=p,m.featureId=d._featureId,m.tableId=o,t.push(m)}}}return t},geojsonFeatures:function(){var e=[],t=this.identifyFeature,a=this.activeParcelLayer;if("pwd-parcel"===t&&"pwd"===a&&this.pwdParcel){var i={};i.geojson=this.pwdParcel,i.color="blue",i.fillColor="blue",i.weight=2,i.opacity=1,i.fillOpacity=.3,i.key=i.geojson.properties.PARCELID,e.push(i)}else if("dor-parcel"===t&&"dor"===a){var o=this.dorParcels.map(function(e){var t={};return t.geojson=e,t.color="blue",t.fillColor="blue",t.weight=2,t.opacity=1,t.fillOpacity=.3,t.key=e.properties.OBJECTID,t});e.push.apply(e,o)}var r=this.activeTopicConfig.geojson;if(r){console.log("topicGeojson exists:",r);for(var n=r.path,s=this.$store.state.sources,l=0,c=n;l<c.length;l+=1){var d=c[l];null!==s&&(s=s[d])}if(null!==s){console.log("path:",s);for(var p=0,u=s;p<u.length;p+=1){var h=u[p],m=Object.assign({},r.style);m.key=h[r.key],m.geojson=h,e.push(m)}}}return e},reactiveGeojsonFeatures:function(){for(var e=[],t=this.$store.state.horizontalTables.filteredData,a=0,i=this.$store.getters.visibleTableIds;a<i.length;a+=1){var o=i[a],r=((this.getConfigForTable(o)||{}).options||{}).mapOverlay;if(r&&"geojson"===r.marker){var n=t[o];if(!(n.length<1)){var s=r.style;n.push(o);for(var l=0,c=n;l<c.length;l+=1){var d=c[l],p=Object.assign({},s);p.geojson=d.geometry,p.key=d.id,p.featureId=d._featureId||null,p.tableId=n[n.length-1],e.push(p)}}}}return e},leafletMarkers:function(){var e=[];return e.push.apply(e,this.markers),e.push.apply(e,this.geojsonFeatures),e}},methods:{getTableFromComps:function(e,t){return(e.filter(function(e){return"horizontal-table"===e.type&&e._id==t})||[])[0]},getConfigForTable:function(e){for(var t=0,a=this.$config.topics||[];t<a.length;t+=1){var i=a[t].components||[],o=this.getTableFromComps(i,e);if(o)return o;for(var r=0,n=i;r<n.length;r+=1){var s=n[r].options||{},l=s.components||s.tables||[];if(l.length>0){var c=this.getTableFromComps(l,e);if(c)return c}}}},bringMarkerToFront:function(e){var t=e._path,a=e._renderer._rootGroup;a.removeChild(t),a.appendChild(t)},handleMarkerMouseover:function(e){if(!this.isMobileOrTablet){var t=e.target.options.data,a=t.featureId,i=t.tableId;this.$store.commit("setActiveFeature",{featureId:a,tableId:i})}},handleMarkerClick:function(e){if(this.isMobileOrTablet){var t=e.target.options.data,a=t.featureId,i=t.tableId;this.$store.commit("setActiveFeature",{featureId:a,tableId:i})}},handleMarkerMouseout:function(e){e.target;this.$store.commit("setActiveFeature",null)},updateMarkerFillColor:function(e){var t=e.options.data,a=t.featureId,i=t.tableId,o=this.fillColorForCircleMarker(a,i),r=Object.assign({},e.options);r.fillColor=o,e.setStyle(r)}}};!function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),a=" .mb-panel-map[data-v-11a08c18] { /*this allows the loading mask to fill the div*/ position: relative; } .mb-map-with-widget[data-v-11a08c18] { height: 50%; } .widget-slot[data-v-11a08c18] { display: inline-block; float: left; } .mb-map-loading-mask[data-v-11a08c18] { /*display: inline;*/ position: absolute; top: 0; height: 100%; width: 100%; background: rgba(0, 0 ,0 , 0.25); z-index: 1000; text-align: center; vertical-align: middle; } .mb-map-loading-mask-inner[data-v-11a08c18] { position: absolute; top: 40%; left: 40%; } /*small retina*/ /*@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi), (max-width: 39.9375em) { .mb-search-control-input { max-width: 250px; } }*/ ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),e.appendChild(t)}}();var cyclomediaMixin=philaVueMapping.CyclomediaMixin,pictometryMixin=philaVueMapping.PictometryMixin,Map_=philaVueMapping.Map_,Control=philaVueMapping.Control,AddressInput$1=philaVueMapping.AddressInput,AddressCandidateList$1=philaVueMapping.AddressCandidateList,EsriTiledMapLayer=philaVueMapping.EsriTiledMapLayer,EsriTiledOverlay=philaVueMapping.EsriTiledOverlay,EsriDynamicMapLayer=philaVueMapping.EsriDynamicMapLayer,EsriFeatureLayer=philaVueMapping.EsriFeatureLayer,Geojson=philaVueMapping.Geojson,CircleMarker=philaVueMapping.CircleMarker,OpacitySlider=philaVueMapping.OpacitySlider,VectorMarker=philaVueMapping.VectorMarker,PngMarker=philaVueMapping.PngMarker,BasemapToggleControl=philaVueMapping.BasemapToggleControl,BasemapSelectControl=philaVueMapping.BasemapSelectControl,FullScreenMapToggleTab=philaVueMapping.FullScreenMapToggleTab,LocationControl=philaVueMapping.LocationControl,CyclomediaButton=philaVueMapping.CyclomediaButton,PictometryButton=philaVueMapping.PictometryButton,CyclomediaRecordingCircle=philaVueMapping.CyclomediaRecordingCircle,CyclomediaRecordingsClient=philaVueMapping.CyclomediaRecordingsClient,SvgViewConeMarker=philaVueMapping.SvgViewConeMarker,MeasureControl=philaVueMapping.MeasureControl,LegendControl=philaVueMapping.LegendControl,BasemapTooltip=philaVueMapping.BasemapTooltip,ControlCorner=philaVueMapping.ControlCorner,MapPanel={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:this.mapPanelContainerClass,attrs:{id:"map-panel-container"}},[e._m(0),e._v(" "),a("map_",{class:{"mb-map-with-widget":this.$store.state.cyclomedia.active||this.$store.state.pictometry.active},attrs:{id:"map-tag",center:this.$store.state.map.center,zoom:this.$store.state.map.zoom,"zoom-control-position":"bottomright","min-zoom":this.$config.map.minZoom,"max-zoom":this.$config.map.maxZoom},on:{"l-click":e.handleMapClick,"l-moveend":e.handleMapMove}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isGeocoding,expression:"isGeocoding"}],staticClass:"mb-map-loading-mask"},[a("div",{staticClass:"mb-map-loading-mask-inner"},[a("i",{staticClass:"fa fa-spinner fa-4x spin"}),e._v(" "),a("h1",[e._v("Finding address...")])])]),e._v(" "),e._l(this.$config.map.basemaps,function(t,i){return e.activeBasemap===i?a("esri-tiled-map-layer",{key:i,attrs:{url:t.url,"max-zoom":t.maxZoom,attribution:t.attribution}}):e._e()}),e._v(" "),e._l(this.$config.map.tiledLayers,function(t,i){return e.tiledLayers.includes(i)?a("esri-tiled-map-layer",{key:i,attrs:{url:t.url,zIndex:t.zIndex,attribution:t.attribution}}):e._e()}),e._v(" "),e._l(this.$config.map.tiledOverlays,function(t,i){return e.activeTiledOverlays.includes(i)?a("esri-tiled-overlay",{key:i,attrs:{url:t.url,zIndex:t.zIndex,opacity:t.opacity}}):e._e()}),e._v(" "),e._l(this.$config.map.dynamicMapLayers,function(t,i){return e.activeDynamicMaps.includes(i)?a("esri-dynamic-map-layer",{key:i,attrs:{url:t.url,attribution:t.attribution,transparent:!0,opacity:t.opacity}}):e._e()}),e._v(" "),e._l(this.$config.map.featureLayers,function(t,i){return e.shouldShowFeatureLayer(i,t.minZoom)?a("esri-feature-layer",{key:i,attrs:{layerName:i,url:t.url,color:t.color,fillColor:t.color,fillOpacity:t.fillOpacity,weight:t.weight,style_:t.style,minZoom:t.minZoom,maxZoom:t.maxZoom,zIndex:t.zIndex,markerType:t.markerType,radius:t.radius,interactive:t.interactive}}):e._e()}),e._v(" "),e._l(this.imageOverlayItems,function(t,i){return e.shouldShowImageOverlay(t.properties.RECMAP)?a("esri-dynamic-map-layer",{key:i,attrs:{url:"//gis.phila.gov/arcgis/rest/services/Atlas/RegMaps/MapServer",layers:[0],layerDefs:"0:NAME='g"+t.properties.RECMAP.toLowerCase()+".tif'",transparent:!0,opacity:.5}}):e._e()}),e._v(" "),e._l(e.markers,function(e,t){return a("vector-marker",{key:e.key,attrs:{latlng:e.latlng,markerColor:e.color}})}),e._v(" "),this.cyclomediaActive?a("png-marker",{attrs:{icon:"../../src/assets/camera.png",latlng:e.cycloLatlng,rotationAngle:e.cycloRotationAngle}}):e._e(),e._v(" "),this.cyclomediaActive?a("svg-view-cone-marker",{attrs:{latlng:e.cycloLatlng,rotationAngle:e.cycloRotationAngle,hFov:e.cycloHFov}}):e._e(),e._v(" "),e._l(e.geojsonFeatures,function(t){return e.shouldShowGeojson(t.key)?a("geojson",{key:t.key,attrs:{geojson:t.geojson,fillColor:t.fillColor,color:t.color,weight:t.weight,opacity:t.opacity,fillOpacity:t.fillOpacity,data:{featureId:t.featureId,tableId:t.tableId}}}):e._e()}),e._v(" "),e._l(e.reactiveGeojsonFeatures,function(t){return e.shouldShowGeojson(t.key)?a("geojson",{key:t.key,attrs:{geojson:t.geojson,fillColor:t.fillColor,color:t.color,weight:t.weight,opacity:t.opacity,fillOpacity:t.fillOpacity,data:{featureId:t.featureId,tableId:t.tableId}},on:{"l-mouseover":e.handleMarkerMouseover,"l-click":e.handleMarkerClick,"l-mouseout":e.handleMarkerMouseout}}):e._e()}),e._v(" "),null!=this.$store.state.map.location.lat?a("circle-marker",{key:Math.random(),attrs:{latlng:this.locationMarker.latlng,radius:this.locationMarker.radius,fillColor:this.locationMarker.fillColor,color:this.locationMarker.color,weight:this.locationMarker.weight,opacity:this.locationMarker.opacity,fillOpacity:this.locationMarker.fillOpacity}}):e._e(),e._v(" "),e._l(e.circleMarkers,function(t){return a("circle-marker",{key:Math.random(),attrs:{latlng:t.latlng,radius:t.radius,fillColor:t.fillColor,color:t.color,weight:t.weight,opacity:t.opacity,fillOpacity:t.fillOpacity,data:{featureId:t.featureId,tableId:t.tableId}},on:{"l-mouseover":e.handleMarkerMouseover,"l-click":e.handleMarkerClick,"l-mouseout":e.handleMarkerMouseout}})}),e._v(" "),a("control-corner",{attrs:{vSide:"top",hSide:"almostright"}}),e._v(" "),a("control-corner",{attrs:{vSide:"top",hSide:"almostleft"}}),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(5),e._v(" "),e._m(7),e._v(" "),this.measureControlEnabled?e._m(8):e._e(),e._v(" "),e._m(9),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),this.addressAutocompleteEnabled?a("AddressCandidateList",{attrs:{position:this.addressInputPosition}}):e._e(),e._v(" "),e._l(e.cyclomediaRecordings,function(t){return e.cyclomediaActive?a("cyclomedia-recording-circle",{key:t.imageId,attrs:{imageId:t.imageId,latlng:[t.lat,t.lng],size:1.2,color:"#3388ff",weight:1},on:{"l-click":e.handleCyclomediaRecordingClick}}):e._e()})],2),e._v(" "),e._t("cycloWidget"),e._v(" "),e._t("pictWidget")],2)},staticRenderFns:[function(){var e=this.$createElement;return(this._self._c||e)("full-screen-map-toggle-tab")},function(){var e=this.$createElement;return(this._self._c||e)("basemap-toggle-control",{attrs:{position:"topright"}})},function(){var e=this.$createElement;return(this._self._c||e)("div",[this.shouldShowImageryToggle?this._m(1):this._e()],1)},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("basemap-select-control",{attrs:{position:this.basemapSelectControlPosition}})],1)},function(){var e=this.$createElement;return(this._self._c||e)("pictometry-button",{attrs:{position:"topright",link:"pictometry",imgSrc:"../../src/assets/pictometry.png"}})},function(){var e=this.$createElement;return(this._self._c||e)("div",[this.shouldShowPictometryButton?this._m(4):this._e()],1)},function(){var e=this.$createElement;return(this._self._c||e)("cyclomedia-button",{attrs:{position:"topright",link:"cyclomedia",imgSrc:"../../src/assets/cyclomedia.png"},on:{click:this.handleCyclomediaButtonClick}})},function(){var e=this.$createElement;return(this._self._c||e)("div",[this.shouldShowCyclomediaButton?this._m(6):this._e()],1)},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("measure-control",{attrs:{position:"bottomleft"}})],1)},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(Object.keys(e.legendControls),function(t){return a("legend-control",{key:t,attrs:{position:"bottomleft",options:e.legendControls[t].options,items:e.legendControls[t].data}})}))},function(){var e=this.$createElement;return(this._self._c||e)("location-control",{attrs:{position:"bottomright"}})},function(){var e=this.$createElement;return(this._self._c||e)("div",[this.geolocationEnabled?this._m(10):this._e()],1)},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AddressInput",{attrs:{position:this.addressInputPosition}})],1)}],_scopeId:"data-v-11a08c18",mixins:[markersMixin,cyclomediaMixin,pictometryMixin],components:{Map_:Map_,Control:Control,AddressInput:AddressInput$1,AddressCandidateList:AddressCandidateList$1,EsriTiledMapLayer:EsriTiledMapLayer,EsriTiledOverlay:EsriTiledOverlay,EsriDynamicMapLayer:EsriDynamicMapLayer,EsriFeatureLayer:EsriFeatureLayer,Geojson:Geojson,CircleMarker:CircleMarker,OpacitySlider:OpacitySlider,VectorMarker:VectorMarker,PngMarker:PngMarker,BasemapToggleControl:BasemapToggleControl,BasemapSelectControl:BasemapSelectControl,FullScreenMapToggleTab:FullScreenMapToggleTab,LocationControl:LocationControl,PictometryButton:PictometryButton,CyclomediaButton:CyclomediaButton,CyclomediaRecordingCircle:CyclomediaRecordingCircle,SvgViewConeMarker:SvgViewConeMarker,MeasureControl:MeasureControl,LegendControl:LegendControl,BasemapTooltip:BasemapTooltip,ControlCorner:ControlCorner},created:function(){var e=this.$config.defaultAddress;e&&this.$controller.goToDefaultAddress(e),(this.$config.cyclomedia||{}).enabled&&(this.$cyclomediaRecordingsClient=new CyclomediaRecordingsClient(this.$config.cyclomedia.recordingsUrl,this.$config.cyclomedia.username,this.$config.cyclomedia.password,4326))},mounted:function(){this.$controller.appDidLoad()},computed:{addressAutocompleteEnabled:function(){return!0===this.$config.addressInput.autocompleteEnabled},addressInputPosition:function(){return this.isMobileOrTablet?"topleft":"topalmostleft"},basemapSelectControlPosition:function(){return this.isMobileOrTablet?"topright":"topalmostright"},shouldShowAddressCandidateList:function(){return this.$store.state.map.shouldShowAddressCandidateList},measureControlEnabled:function(){return!1!==this.$config.measureControlEnabled},fullScreenMapEnabled:function(){return this.$store.state.fullScreenMapEnabled},fullScreenTopicsEnabled:function(){return this.$store.state.fullScreenTopicsEnabled},mapPanelContainerClass:function(){return this.fullScreenMapEnabled?"medium-24 small-order-1 small-24 medium-order-2 mb-panel mb-panel-map":this.fullScreenMapOnly?"medium-1 small-order-1 small-1 medium-order-2 mb-panel mb-panel-map":this.fullScreenTopicsEnabled?"medium-1 small-order-1 small-24 medium-order-2 mb-panel mb-panel-map":"medium-12 small-order-1 small-24 medium-order-2 mb-panel mb-panel-map"},cycloLatlng:function(){if(null!==this.$store.state.cyclomedia.orientation.xyz){var e=this.$store.state.cyclomedia.orientation.xyz;return[e[1],e[0]]}return this.$config.map.center},cycloRotationAngle:function(){return 57.29577951307855*this.$store.state.cyclomedia.orientation.yaw},cycloHFov:function(){return this.$store.state.cyclomedia.orientation.hFov},isMobileOrTablet:function(){return this.$store.state.isMobileOrTablet},shouldShowCyclomediaButton:function(){return this.$config.cyclomedia.enabled&&!this.isMobileOrTablet},shouldShowPictometryButton:function(){return this.$config.pictometry.enabled&&!this.isMobileOrTablet},geolocationEnabled:function(){return this.$config.geolocation.enabled},activeDorParcel:function(){return this.$store.state.parcels.dor.activeParcel},legendControls:function(){return this.$config.legendControls},imageOverlay:function(){return this.$store.state.map.imageOverlay},imageOverlayItems:function(){if(this.activeTopicConfig.imageOverlayGroup){var e=this.activeTopicConfig.imageOverlayGroup,t=this.$store.state;return this.$config.imageOverlayGroups[e].items(t)}return[]},imageOverlayInfo:function(){return console.log("config:",this.$config),this.$config.map.dynamicMapLayers.regmaps},activeBasemap:function(){if(this.$store.state.map.shouldShowImagery)return this.$store.state.map.imagery;var e=this.$config.map.defaultBasemap;return this.$store.state.map.basemap||e},tiledLayers:function(){var e=this.activeBasemap;return this.configForBasemap(e).tiledLayers||[]},activeTiledOverlays:function(){return this.activeTopicConfig&&this.activeTopicConfig.tiledOverlays?this.activeTopicConfig.tiledOverlays:[]},activeDynamicMaps:function(){return this.activeTopicConfig&&this.activeTopicConfig.dynamicMapLayers?this.activeTopicConfig.dynamicMapLayers:[]},activeFeatureLayers:function(){return this.activeTopicConfig&&this.activeTopicConfig.featureLayers?this.activeTopicConfig.featureLayers:[]},activeFeature:function(){return this.$store.state.activeFeature},basemaps:function(){return Object.values(this.$config.map.basemaps)},imageryBasemaps:function(){return this.basemaps.filter(function(e){return"imagery"===e.type})},hasImageryBasemaps:function(){return this.imageryBasemaps.length>0},shouldShowImageryToggle:function(){return this.hasImageryBasemaps},identifyFeature:function(){var e;return"intersection"===this.geocodeType?e="address-marker":this.activeTopicConfig.identifyFeature?e=this.activeTopicConfig.identifyFeature:this.$config&&(e=this.$config.map.defaultIdentifyFeature),e},activeTopic:function(){return this.$store.state.activeTopic},activeTopicConfig:function(){var e,t=this.activeTopic;return t&&(e=this.$config.topics.filter(function(e){return e.key===t})[0]),e||{}},activeParcelLayer:function(){return this.activeTopicConfig.parcels},dorParcels:function(){return this.$store.state.parcels.dor.data},pwdParcel:function(){return this.$store.state.parcels.pwd},geocodeResult:function(){return this.$store.state.geocode.data||{}},geocodeGeom:function(){return this.geocodeResult.geometry},geocodeType:function(){return this.geocodeResult.ais_feature_type},streetAddress:function(){return this.geocodeResult.properties.street_address},picOrCycloActive:function(){return!(!this.cyclomediaActive&&!this.pictometryActive)},mapBounds:function(){},boundsBasedOnShape:function(){return this.$store.state.map.boundsBasedOnShape},isGeocoding:function(){return"waiting"===this.$store.state.geocode.status}},watch:{picOrCycloActive:function(e){var t=this;this.$nextTick(function(){t.$store.state.map.map.invalidateSize()})},geojsonFeatures:function(){this.setMapToBounds()},markers:function(){this.setMapToBounds()},fullScreenTopicsEnabled:function(){var e=this;this.$nextTick(function(){e.$store.state.map.map.invalidateSize()})}},methods:{setMapToBounds:function(){var e=[];if(this.activeTopicConfig.zoomToShape){if(this.activeTopicConfig.zoomToShape.includes("geojson"))for(var t=0,a=this.geojsonFeatures;t<a.length;t+=1){var i=a[t];e.push(L.geoJSON(i.geojson))}if(this.activeTopicConfig.zoomToShape.includes("marker"))for(var o=0,r=this.markers;o<r.length;o+=1){var n=r[o];"overlay"===n.markerType&&e.push(L.marker(n.latlng))}var s=new L.featureGroup(e).getBounds();this.$store.commit("setMapBounds",s)}},configForBasemap:function(e){return this.$config.map.basemaps[e]||{}},shouldShowGeojson:function(e){return"pwd"===this.activeTopicConfig.basemap||e===this.activeDorParcel},shouldShowImageOverlay:function(e){return e===this.imageOverlay},shouldShowFeatureLayer:function(e){return!!this.activeFeatureLayers.includes(e)},handleMapClick:function(e){this.$controller.handleMapClick(e)},handleMapMove:function(e){var t=this.$store.state.map.map,a=this.$config.pictometry||{},i=t.getCenter(),o=i.lat,r=i.lng,n=[r,o];if(a.enabled){this.$store.commit("setPictometryMapCenter",n);var s=t.getZoom();this.$store.commit("setPictometryMapZoom",s)}(this.$config.cyclomedia||{}).enabled&&(this.updateCyclomediaRecordings(),this.$store.commit("setCyclomediaLatLngFromMap",[o,r]))},fillColorForCircleMarker:function(e,t){var a=this.getConfigForTable(t).options.mapOverlay,i=a.style,o=a.hoverStyle,r=this.activeFeature;return(e===r.featureId&&t===r.tableId?o:i).fillColor}}};!function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),a=" /*don't highlight any form elements*/ input:focus, select:focus, textarea:focus, button:focus { outline: none; } .mb-panel-topics-with-widget { height: 50%; } /* standards applies padding to buttons, which causes some weirdness with buttons on the map panel. override here. */ button { padding: inherit; } .topic-panel-false { /* display: none; */ } @media screen and (min-width: 46.875em) { .topic-panel-false { display: none; } .map-panel-false { display: none; } } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),e.appendChild(t)}}();var CyclomediaWidget=philaVueMapping.CyclomediaWidget,PictometryWidget=philaVueMapping.PictometryWidget,Layer=philaVueMapping.PictometryLayer,ViewCone=philaVueMapping.PictometryViewCone,PngMarker$1=philaVueMapping.PictometryPngMarker,Mapboard={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.rootClass,style:e.mbRootStyle,attrs:{id:"mb-root"}},[a("topic-panel",{class:this.shouldShowTopicPanel}),e._v(" "),!0!==this.fullScreenTopicsOnly?a("map-panel",{class:this.shouldShowMapPanel},[this.shouldLoadCyclomediaWidget?a("cyclomedia-widget",{directives:[{name:"show",rawName:"v-show",value:e.cyclomediaActive,expression:"cyclomediaActive"}],attrs:{slot:"cycloWidget","screen-percent":"2"},slot:"cycloWidget"}):e._e(),e._v(" "),this.shouldLoadPictometryWidget?a("pictometry-widget",{directives:[{name:"show",rawName:"v-show",value:e.pictometryActive,expression:"pictometryActive"}],attrs:{slot:"pictWidget",apiKey:this.ak,secretKey:this.sk},slot:"pictWidget"},[this.pictometryShowAddressMarker?a("png-marker",{attrs:{latlng:[this.geocodeData.geometry.coordinates[1],this.geocodeData.geometry.coordinates[0]],icon:"markers.png",height:60,width:40,offsetX:0,offsetY:0}}):e._e(),e._v(" "),this.pictometryActive?a("layer"):e._e(),e._v(" "),this.cyclomediaActive&&this.pictometryActive?a("png-marker",{attrs:{latlng:e.cycloLatlng,icon:"camera2.png",height:20,width:30,offsetX:-2,offsetY:-2}}):e._e(),e._v(" "),this.cyclomediaActive&&this.pictometryActive?a("view-cone",{attrs:{latlng:e.cycloLatlng,rotationAngle:e.cycloRotationAngle,hFov:e.cycloHFov}}):e._e()],1):e._e()],1):e._e()],1)},staticRenderFns:[],components:{TopicPanel:TopicPanel,MapPanel:MapPanel,CyclomediaWidget:CyclomediaWidget,PictometryWidget:PictometryWidget,Layer:Layer,PngMarker:PngMarker$1,ViewCone:ViewCone},data:function(){return{mbRootStyle:{height:"100px"}}},created:function(){this.$config.panels&&(this.$config.panels.includes("map")?this.$config.panels.includes("topics")||this.$store.commit("setMapOnly",!0):this.$store.commit("setTopicsOnly",!0)),window.addEventListener("click",this.closeAddressCandidateList),window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()},computed:{rootClass:function(){return this.$config.plugin?"grid-x":"cell medium-auto grid-x"},isMobileOrTablet:function(){return this.$store.state.isMobileOrTablet},shouldLoadCyclomediaWidget:function(){return this.$config.cyclomedia.enabled&&!this.isMobileOrTablet},shouldLoadPictometryWidget:function(){return this.$config.pictometry.enabled&&!this.isMobileOrTablet},fullScreenMapOnly:function(){return this.$store.state.fullScreen.mapOnly},fullScreenMapEnabled:function(){return this.$store.state.fullScreenMapEnabled},fullScreenTopicsOnly:function(){return this.$store.state.fullScreen.topicsOnly},fullScreenTopicsEnabled:function(){return this.$store.state.fullScreenTopicsEnabled},shouldShowTopicPanel:function(){return this.fullScreenMapEnabled||this.fullScreenMapOnly?"topic-panel-false":"topic-panel-true"},shouldShowMapPanel:function(){return this.fullScreenTopicsEnabled||this.fullScreenTopicsOnly?"map-panel-false":"map-panel-true"},cyclomediaActive:function(){return this.$store.state.cyclomedia.active},cycloLatlng:function(){if(null!==this.$store.state.cyclomedia.orientation.xyz){var e=this.$store.state.cyclomedia.orientation.xyz;return[e[1],e[0]]}return this.$config.map.center},cycloRotationAngle:function(){return 57.29577951307855*this.$store.state.cyclomedia.orientation.yaw},cycloHFov:function(){return this.$store.state.cyclomedia.orientation.hFov},pictometryActive:function(){return this.$store.state.pictometry.active},pictometryZoom:function(){return this.$store.state.pictometry.zoom},pictometryShowAddressMarker:function(){return!(!this.pictometryActive||!this.geocodeData)&&!(this.pictometryZoom<20&&this.cyclomediaActive)},geocodeData:function(){return this.$store.state.geocode.data},ak:function(){var e=window.location.hostname;return"atlas.phila.gov"===e?this.$config.pictometry.apiKey:"atlas-dev.phila.gov"===e?this.$config.pictometryDev.apiKey:"cityatlas.phila.gov"===e?this.$config.pictometryCity.apiKey:"cityatlas-dev.phila.gov"===e?this.$config.pictometryCityDev.apiKey:"10.8.101.67"===e?this.$config.pictometryLocal.apiKey:void 0},sk:function(){var e=window.location.hostname;return"atlas.phila.gov"===e?this.$config.pictometry.secretKey:"atlas-dev.phila.gov"===e?this.$config.pictometryDev.secretKey:"cityatlas.phila.gov"===e?this.$config.pictometryCity.secretKey:"cityatlas-dev.phila.gov"===e?this.$config.pictometryCityDev.secretKey:"10.8.101.67"===e?this.$config.pictometryLocal.secretKey:void 0}},watch:{pictometryShowAddressMarker:function(e){console.log("watch pictometryShowAddressMarker",e)}},methods:{closeAddressCandidateList:function(){this.$store.state.map.shouldShowAddressCandidateList=!1},handleWindowResize:function(){$(window).width()>=750?this.mbRootStyle.height="600px":this.mbRootStyle.height="auto"}}};function isObject(e){return e&&"object"==typeof e&&!Array.isArray(e)&&null!==e}function mergeDeep(e,t){var a=Object.assign({},e);return isObject(e)&&isObject(t)&&Object.keys(t).forEach(function(i){var o,r;isObject(t[i])?i in e?a[i]=mergeDeep(e[i],t[i]):Object.assign(a,((o={})[i]=t[i],o)):Object.assign(a,((r={})[i]=t[i],r))}),a}function generateUniqueId(){return Math.random().toString(36).substring(7)}var controllerMixin=philaVueDatafetch;function assignTableIds(e){for(var t=0,a=e;t<a.length;t+=1){var i=a[t],o=i.options||{},r=o.components||o.tables;if(r&&assignTableIds(r),"horizontal-table"===i.type){var n=generateUniqueId();i._id=n,i.options.tableId=n}}}function assignHorizontalTableGroupIds(e){for(var t=0,a=e;t<a.length;t+=1){var i=a[t];if((i.options||{}).tables&&"horizontal-table-group"===i.type){var o=generateUniqueId();i._id=o,i.options.horizontalTableGroupId=o}}}function initMapboard(clientConfig){var baseConfigUrl=clientConfig.baseConfig;return axios.get(baseConfigUrl).then(function(response){for(var data=response.data,baseConfigFn=eval(data),gatekeeperKey=clientConfig.gatekeeperKey,baseConfig=baseConfigFn({gatekeeperKey:gatekeeperKey}),config=mergeDeep(baseConfig,clientConfig),i=0,list=config.topics;i<list.length;i+=1){var topic=list[i];assignTableIds(topic.components),assignHorizontalTableGroupIds(topic.components)}Vue.use(configMixin,config);var store=createStore(config);Vue.use(controllerMixin,{config:config,store:store});var vm=new Vue({el:config.el||"#mapboard",render:function(e){return e(Mapboard)},store:store})}).catch(function(e){console.error("Error loading base config:",e)})}exports.default=initMapboard,exports.Mapboard=Mapboard,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=mapboard.js.map
